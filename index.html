<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–ù–ö–ï–¢–ê: –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –≥–ª–∞–∑–∞–º–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
            background-color: #f5f5f5;
        }
        .form-container {
            max-width: 850px;
            margin: 0 auto;
            border: 1px solid #ccc;
            padding: 25px;
            border-radius: 10px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #4CAF50;
        }
        .header h1 {
            color: #2c3e50;
            font-size: 32px;
            margin-bottom: 5px;
        }
        .header h2 {
            color: #4CAF50;
            font-size: 22px;
            margin-top: 0;
            font-weight: normal;
        }
        .intro-box {
            background-color: #e8f5e9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 4px solid #4CAF50;
            font-size: 14px;
        }
        .intro-box strong {
            color: #2c3e50;
            font-size: 15px;
        }
        .teacher-block {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            transition: all 0.3s ease;
            background-color: #fafafa;
        }
        .teacher-block.unrated {
            border: 2px solid #ff9800;
            background-color: #fff3e0;
        }
        .teacher-block.high-rated {
            background-color: #e8f5e9;
            border-left: 4px solid #4CAF50;
        }
        .teacher-block.low-rated {
            background-color: #ffebee;
            border-left: 4px solid #f44336;
        }
        .group-select {
            margin: 15px 0;
            padding: 10px;
            font-size: 16px;
            width: 250px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .rating-options {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        .rating-options label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 5px 10px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            transition: all 0.2s;
        }
        .rating-options label:hover {
            background-color: #f0f0f0;
        }
        .rating-options input[type="radio"] {
            cursor: pointer;
            transform: scale(1.2);
        }
        .submit-btn {
            background-color: #4CAF50;
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            display: block;
            margin: 30px auto 0;
            font-weight: bold;
            transition: all 0.3s;
        }
        .submit-btn:hover {
            background-color: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .submit-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .export-btn {
            background-color: #2196F3;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
            font-size: 15px;
            transition: background-color 0.3s;
        }
        .export-btn:hover {
            background-color: #0b7dda;
        }
        .clear-btn {
            background-color: #ff4444;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px auto;
            display: block;
            font-size: 12px;
        }
        .clear-btn:hover {
            background-color: #cc0000;
        }
        .stats {
            margin-top: 20px;
            padding: 20px;
            background-color: #f0f8ff;
            border-radius: 5px;
            border-left: 4px solid #2196F3;
        }
        .rating-badge {
            display: inline-block;
            background-color: #4CAF50;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            min-width: 60px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .teacher-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        .teacher-title {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
        }
        .teacher-subject {
            font-size: 14px;
            color: #555;
            font-style: italic;
        }
        .sort-controls {
            margin: 20px 0;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            border: 1px solid #eee;
        }
        .sort-btn {
            background-color: #607d8b;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            white-space: nowrap;
            transition: background-color 0.3s;
        }
        .sort-btn.active {
            background-color: #2196F3;
        }
        .sort-btn:hover {
            background-color: #546e7a;
        }
        .teacher-counter {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
            text-align: center;
            font-style: italic;
        }
        .instructions {
            font-size: 13px;
            color: #777;
            margin-top: 5px;
            font-style: italic;
        }
        .rating-scale {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            font-size: 13px;
        }
        .scale-item {
            text-align: center;
            flex: 1;
        }
        .scale-number {
            font-weight: bold;
            font-size: 16px;
            color: #4CAF50;
        }
        .required-note {
            color: #d32f2f;
            font-size: 12px;
            margin-top: 5px;
        }
        .validation-error {
            color: #d32f2f;
            font-size: 13px;
            margin-top: 5px;
            display: none;
        }
        .progress-bar {
            height: 5px;
            background-color: #e0e0e0;
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background-color: #4CAF50;
            width: 0%;
            transition: width 0.3s;
        }
        .progress-text {
            text-align: center;
            font-size: 12px;
            color: #666;
        }
        .status-message {
            text-align: center;
            margin: 15px 0;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        .status-success {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }
        .status-error {
            background-color: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }
        .status-info {
            background-color: #e3f2fd;
            color: #1565c0;
            border: 1px solid #bbdefb;
        }
        .buttons-container {
            text-align: center;
            margin: 20px 0;
        }
        .rating-legend {
            font-size: 12px;
            color: #666;
            text-align: center;
            margin: 10px 0;
            font-style: italic;
        }
        .teacher-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .teacher-stat:last-child {
            border-bottom: none;
        }
        .stat-name {
            flex: 2;
        }
        .stat-rating {
            flex: 1;
            text-align: right;
            font-weight: bold;
            color: #4CAF50;
        }
        .stat-subject {
            flex: 2;
            font-style: italic;
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <div class="header">
            <h1>–ê–ù–ö–ï–¢–ê</h1>
            <h2>¬´–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –≥–ª–∞–∑–∞–º–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞¬ª</h2>
        </div>

        <div class="intro-box">
            <p><strong>–£–≤–∞–∂–∞–µ–º—ã–π —Å—Ç—É–¥–µ–Ω—Ç!</strong></p>
            <p>–° —Ü–µ–ª—å—é –ø–æ–≤—ã—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è —É—á–µ–±–Ω—ã—Ö –¥–∏—Å—Ü–∏–ø–ª–∏–Ω –ø—Ä–æ—Å–∏–º –í–∞—Å –ø—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ –≤ –∞–Ω–æ–Ω–∏–º–Ω–æ–º –æ–ø—Ä–æ—Å–µ –∏ –æ—Ü–µ–Ω–∏—Ç—å —Ä–∞–±–æ—Ç—É –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≤–æ–¥–∏–ª–∏ —É –≤–∞—Å –∑–∞–Ω—è—Ç–∏—è.</p>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–µ–≥–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è –∏ –æ—Ü–µ–Ω–∏—Ç–µ –µ–≥–æ —Ä–∞–±–æ—Ç—É –≤ –±–∞–ª–ª–∞—Ö –æ—Ç 1 –¥–æ 5.</p>
            <p><strong>–í–∞–∂–Ω–æ:</strong> –° –æ–¥–Ω–æ–≥–æ IP-–∞–¥—Ä–µ—Å–∞ –º–æ–∂–Ω–æ –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑.</p>
            <p><strong>–°–ø–∞—Å–∏–±–æ!</strong></p>
        </div>

        <div class="rating-scale">
            <div class="scale-item"><span class="scale-number">5</span><br>–û—Ç–ª–∏—á–Ω–æ</div>
            <div class="scale-item"><span class="scale-number">4</span><br>–•–æ—Ä–æ—à–æ</div>
            <div class="scale-item"><span class="scale-number">3</span><br>–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ</div>
            <div class="scale-item"><span class="scale-number">2</span><br>–ü–ª–æ—Ö–æ</div>
            <div class="scale-item"><span class="scale-number">1</span><br>–û—á–µ–Ω—å –ø–ª–æ—Ö–æ</div>
        </div>
        
        <div class="rating-legend">–ó–µ–ª—ë–Ω—ã–π –∑–Ω–∞—á–æ–∫ —Å–ø—Ä–∞–≤–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è</div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">–ó–∞–ø–æ–ª–Ω–µ–Ω–æ: 0/13 –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π (0%)</div>

        <div>
            <label for="group"><strong>–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à—É –≥—Ä—É–ø–ø—É:</strong></label><br>
            <select id="group" name="group" class="group-select" required>
                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É --</option>
                <option value="23–ü–ì01">23–ü–ì01</option>
                <option value="23–ü–ì02">23–ü–ì02</option>
                <option value="–î—Ä—É–≥–∞—è">–î—Ä—É–≥–∞—è –≥—Ä—É–ø–ø–∞</option>
            </select>
            <div class="required-note">* –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ</div>
            <div class="validation-error" id="groupError">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É</div>
        </div>

        <div class="sort-controls">
            <strong>–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π:</strong>
            <button class="sort-btn active" onclick="sortTeachers('original')">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</button>
            <button class="sort-btn" onclick="sortTeachers('rating')">–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É ‚Üì</button>
            <button class="sort-btn" onclick="sortTeachers('rating-asc')">–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É ‚Üë</button>
            <button class="sort-btn" onclick="sortTeachers('alphabet')">–ü–æ –∞–ª—Ñ–∞–≤–∏—Ç—É</button>
        </div>

        <div id="teachers-container">
            <!-- –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å 1 -->
            <div class="teacher-block" data-teacher="prokhorov" data-rating="0">
                <div class="teacher-header">
                    <div>
                        <div class="teacher-title">–î–æ—Ü–µ–Ω—Ç –ü—Ä–æ—Ö–æ—Ä–æ–≤-–ú–∞–ª—è—Å–æ–≤ –ì–µ–æ—Ä–≥–∏–π –°–µ—Ä–≥–µ–µ–≤–∏—á</div>
                        <div class="teacher-subject">–§–∏–ª–æ—Å–æ—Ñ–∏—è</div>
                    </div>
                    <span class="rating-badge" id="badge-prokhorov">-</span>
                </div>
                <div class="instructions">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5:</div>
                <div class="rating-options">
                    <label><input type="radio" name="teacher1" value="1" required> 1</label>
                    <label><input type="radio" name="teacher1" value="2"> 2</label>
                    <label><input type="radio" name="teacher1" value="3"> 3</label>
                    <label><input type="radio" name="teacher1" value="4"> 4</label>
                    <label><input type="radio" name="teacher1" value="5"> 5</label>
                </div>
                <div class="validation-error" id="error-teacher1">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É</div>
            </div>

            <!-- –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å 2 -->
            <div class="teacher-block" data-teacher="antonova" data-rating="0">
                <div class="teacher-header">
                    <div>
                        <div class="teacher-title">–°—Ç–∞—Ä—à–∏–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –ê–Ω—Ç–æ–Ω–æ–≤–∞ –ò–ª—å–≤–∏—Ä–∞ –ò–ª–≥–∏–∑–æ–≤–Ω–∞</div>
                        <div class="teacher-subject">–≠–∫–æ–ª–æ–≥–∏—è</div>
                    </div>
                    <span class="rating-badge" id="badge-antonova">-</span>
                </div>
                <div class="instructions">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5:</div>
                <div class="rating-options">
                    <label><input type="radio" name="teacher2" value="1" required> 1</label>
                    <label><input type="radio" name="teacher2" value="2"> 2</label>
                    <label><input type="radio" name="teacher2" value="3"> 3</label>
                    <label><input type="radio" name="teacher2" value="4"> 4</label>
                    <label><input type="radio" name="teacher2" value="5"> 5</label>
                </div>
                <div class="validation-error" id="error-teacher2">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É</div>
            </div>

            <!-- –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å 3 -->
            <div class="teacher-block" data-teacher="siraziev" data-rating="0">
                <div class="teacher-header">
                    <div>
                        <div class="teacher-title">–î–æ—Ü–µ–Ω—Ç –°–∏—Ä–∞–∑–∏–µ–≤ –õ–µ–Ω–∞—Ä –§–∏—Ä–≥–∞—Ç–µ–≤–∏—á</div>
                        <div class="teacher-subject">–ò–Ω–∂–µ–Ω–µ—Ä–Ω–∞—è –≥–µ–æ–ª–æ–≥–∏—è</div>
                    </div>
                    <span class="rating-badge" id="badge-siraziev">-</span>
                </div>
                <div class="instructions">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5:</div>
                <div class="rating-options">
                    <label><input type="radio" name="teacher3" value="1" required> 1</label>
                    <label><input type="radio" name="teacher3" value="2"> 2</label>
                    <label><input type="radio" name="teacher3" value="3"> 3</label>
                    <label><input type="radio" name="teacher3" value="4"> 4</label>
                    <label><input type="radio" name="teacher3" value="5"> 5</label>
                </div>
                <div class="validation-error" id="error-teacher3">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É</div>
            </div>

            <!-- –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å 4 -->
            <div class="teacher-block" data-teacher="sibgatullin" data-rating="0">
                <div class="teacher-header">
                    <div>
                        <div class="teacher-title">–î–æ—Ü–µ–Ω—Ç –°–∏–±–≥–∞—Ç—É–ª–ª–∏–Ω –ú–∞—Ä–∞—Ç –¢–∞—Ñ–∫–∏–ª–æ–≤–∏—á</div>
                        <div class="teacher-subject">–ú–µ—Ç—Ä–æ–ª–æ–≥–∏—è, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–æ–º</div>
                    </div>
                    <span class="rating-badge" id="badge-sibgatullin">-</span>
                </div>
                <div class="instructions">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5:</div>
                <div class="rating-options">
                    <label><input type="radio" name="teacher4" value="1" required> 1</label>
                    <label><input type="radio" name="teacher4" value="2"> 2</label>
                    <label><input type="radio" name="teacher4" value="3"> 3</label>
                    <label><input type="radio" name="teacher4" value="4"> 4</label>
                    <label><input type="radio" name="teacher4" value="5"> 5</label>
                </div>
                <div class="validation-error" id="error-teacher4">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É</div>
            </div>

            <!-- –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å 5 -->
            <div class="teacher-block" data-teacher="ermolaeva" data-rating="0">
                <div class="teacher-header">
                    <div>
                        <div class="teacher-title">–î–æ—Ü–µ–Ω—Ç –ï—Ä–º–æ–ª–∞–µ–≤–∞ –õ–µ–π–ª–∞ –ë–∏–ª—Å—É—Ä–æ–≤–Ω–∞</div>
                        <div class="teacher-subject">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</div>
                    </div>
                    <span class="rating-badge" id="badge-ermolaeva">-</span>
                </div>
                <div class="instructions">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5:</div>
                <div class="rating-options">
                    <label><input type="radio" name="teacher5" value="1" required> 1</label>
                    <label><input type="radio" name="teacher5" value="2"> 2</label>
                    <label><input type="radio" name="teacher5" value="3"> 3</label>
                    <label><input type="radio" name="teacher5" value="4"> 4</label>
                    <label><input type="radio" name="teacher5" value="5"> 5</label>
                </div>
                <div class="validation-error" id="error-teacher5">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É</div>
            </div>

            <!-- –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å 6 -->
            <div class="teacher-block" data-teacher="rakhimova" data-rating="0">
                <div class="teacher-header">
                    <div>
                        <div class="teacher-title">–ü—Ä–æ—Ñ–µ—Å—Å–æ—Ä –†–∞—Ö–∏–º–æ–≤–∞ –ù–∞–∏–ª—è –†–∞–≤–∏–ª–µ–≤–Ω–∞</div>
                        <div class="teacher-subject">–°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</div>
                    </div>
                    <span class="rating-badge" id="badge-rakhimova">-</span>
                </div>
                <div class="instructions">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5:</div>
                <div class="rating-options">
                    <label><input type="radio" name="teacher6" value="1" required> 1</label>
                    <label><input type="radio" name="teacher6" value="2"> 2</label>
                    <label><input type="radio" name="teacher6" value="3"> 3</label>
                    <label><input type="radio" name="teacher6" value="4"> 4</label>
                    <label><input type="radio" name="teacher6" value="5"> 5</label>
                </div>
                <div class="validation-error" id="error-teacher6">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É</div>
            </div>

            <!-- –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å 7 -->
            <div class="teacher-block" data-teacher="kashina" data-rating="0">
                <div class="teacher-header">
                    <div>
                        <div class="teacher-title">–î–æ—Ü–µ–Ω—Ç –ö–∞—à–∏–Ω–∞ –°–≤–µ—Ç–ª–∞–Ω–∞ –ì–µ–æ—Ä–≥–∏–µ–≤–Ω–∞</div>
                        <div class="teacher-subject">–ü—Ä–∞–≤–æ–≤–æ–µ —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞. –ö–æ—Ä—Ä—É–ø—Ü–∏–æ–Ω–Ω—ã–µ —Ä–∏—Å–∫–∏</div>
                    </div>
                    <span class="rating-badge" id="badge-kashina">-</span>
                </div>
                <div class="instructions">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5:</div>
                <div class="rating-options">
                    <label><input type="radio" name="teacher7" value="1" required> 1</label>
                    <label><input type="radio" name="teacher7" value="2"> 2</label>
                    <label><input type="radio" name="teacher7" value="3"> 3</label>
                    <label><input type="radio" name="teacher7" value="4"> 4</label>
                    <label><input type="radio" name="teacher7" value="5"> 5</label>
                </div>
                <div class="validation-error" id="error-teacher7">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É</div>
            </div>

            <!-- –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å 8 -->
            <div class="teacher-block" data-teacher="nizamova" data-rating="0">
                <div class="teacher-header">
                    <div>
                        <div class="teacher-title">–°—Ç–∞—Ä—à–∏–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –ù–∏–∑–∞–º–æ–≤–∞ –ê–∏–¥–∞ –•–∞–Ω–∏—Ñ–æ–≤–Ω–∞</div>
                        <div class="teacher-subject">–û—Å–Ω–æ–≤—ã –≤–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏—è –∏ –≤–æ–¥–æ–æ—Ç–≤–µ–¥–µ–Ω–∏—è</div>
                    </div>
                    <span class="rating-badge" id="badge-nizamova">-</span>
                </div>
                <div class="instructions">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5:</div>
                <div class="rating-options">
                    <label><input type="radio" name="teacher8" value="1" required> 1</label>
                    <label><input type="radio" name="teacher8" value="2"> 2</label>
                    <label><input type="radio" name="teacher8" value="3"> 3</label>
                    <label><input type="radio" name="teacher8" value="4"> 4</label>
                    <label><input type="radio" name="teacher8" value="5"> 5</label>
                </div>
                <div class="validation-error" id="error-teacher8">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É</div>
            </div>

            <!-- –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å 9 -->
            <div class="teacher-block" data-teacher="medvedeva" data-rating="0">
                <div class="teacher-header">
                    <div>
                        <div class="teacher-title">–î–æ—Ü–µ–Ω—Ç –ú–µ–¥–≤–µ–¥–µ–≤–∞ –ì–∞–ª–∏–Ω–∞ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–Ω–∞</div>
                        <div class="teacher-subject">–û—Å–Ω–æ–≤—ã —Ç–µ–ø–ª–æ–≥–∞–∑–æ—Å–Ω–∞–±–∂–µ–Ω–∏—è –∏ –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è</div>
                    </div>
                    <span class="rating-badge" id="badge-medvedeva">-</span>
                </div>
                <div class="instructions">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5:</div>
                <div class="rating-options">
                    <label><input type="radio" name="teacher9" value="1" required> 1</label>
                    <label><input type="radio" name="teacher9" value="2"> 2</label>
                    <label><input type="radio" name="teacher9" value="3"> 3</label>
                    <label><input type="radio" name="teacher9" value="4"> 4</label>
                    <label><input type="radio" name="teacher9" value="5"> 5</label>
                </div>
                <div class="validation-error" id="error-teacher9">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É</div>
            </div>

            <!-- –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å 10 -->
            <div class="teacher-block" data-teacher="sundukov" data-rating="0">
                <div class="teacher-header">
                    <div>
                        <div class="teacher-title">–î–æ—Ü–µ–Ω—Ç –°—É–Ω–¥—É–∫–æ–≤ –í–∏–∫—Ç–æ—Ä –ò–≤–∞–Ω–æ–≤–∏—á</div>
                        <div class="teacher-subject">–≠–ª–µ–∫—Ç—Ä–æ—Ç–µ—Ö–Ω–∏–∫–∞ –∏ —ç–ª–µ–∫—Ç—Ä–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ</div>
                    </div>
                    <span class="rating-badge" id="badge-sundukov">-</span>
                </div>
                <div class="instructions">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5:</div>
                <div class="rating-options">
                    <label><input type="radio" name="teacher10" value="1" required> 1</label>
                    <label><input type="radio" name="teacher10" value="2"> 2</label>
                    <label><input type="radio" name="teacher10" value="3"> 3</label>
                    <label><input type="radio" name="teacher10" value="4"> 4</label>
                    <label><input type="radio" name="teacher10" value="5"> 5</label>
                </div>
                <div class="validation-error" id="error-teacher10">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É</div>
            </div>

            <!-- –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å 11 -->
            <div class="teacher-block" data-teacher="mirsayapov" data-rating="0">
                <div class="teacher-header">
                    <div>
                        <div class="teacher-title">–ü—Ä–æ—Ñ–µ—Å—Å–æ—Ä –ú–∏—Ä—Å–∞—è–ø–æ–≤ –ò–ª–∏–∑–∞—Ä –¢–∞–ª–≥–∞—Ç–æ–≤–∏—á</div>
                        <div class="teacher-subject">–û—Å–Ω–æ–≤—ã –≥–µ–æ—Ç–µ—Ö–Ω–∏–∫–∏</div>
                    </div>
                    <span class="rating-badge" id="badge-mirsayapov">-</span>
                </div>
                <div class="instructions">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5:</div>
                <div class="rating-options">
                    <label><input type="radio" name="teacher11" value="1" required> 1</label>
                    <label><input type="radio" name="teacher11" value="2"> 2</label>
                    <label><input type="radio" name="teacher11" value="3"> 3</label>
                    <label><input type="radio" name="teacher11" value="4"> 4</label>
                    <label><input type="radio" name="teacher11" value="5"> 5</label>
                </div>
                <div class="validation-error" id="error-teacher11">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É</div>
            </div>

            <!-- –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å 12 -->
            <div class="teacher-block" data-teacher="ivantsov" data-rating="0">
                <div class="teacher-header">
                    <div>
                        <div class="teacher-title">–î–æ—Ü–µ–Ω—Ç –ò–≤–∞–Ω—Ü–æ–≤ –ê–ª–µ–∫—Å–µ–π –ò–≥–æ—Ä–µ–≤–∏—á</div>
                        <div class="teacher-subject">–û—Å–Ω–æ–≤—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã</div>
                    </div>
                    <span class="rating-badge" id="badge-ivantsov">-</span>
                </div>
                <div class="instructions">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5:</div>
                <div class="rating-options">
                    <label><input type="radio" name="teacher12" value="1" required> 1</label>
                    <label><input type="radio" name="teacher12" value="2"> 2</label>
                    <label><input type="radio" name="teacher12" value="3"> 3</label>
                    <label><input type="radio" name="teacher12" value="4"> 4</label>
                    <label><input type="radio" name="teacher12" value="5"> 5</label>
                </div>
                <div class="validation-error" id="error-teacher12">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É</div>
            </div>

            <!-- –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å 13 -->
            <div class="teacher-block" data-teacher="mukhametrakhimov" data-rating="0">
                <div class="teacher-header">
                    <div>
                        <div class="teacher-title">–î–æ—Ü–µ–Ω—Ç –ú—É—Ö–∞–º–µ—Ç—Ä–∞—Ö–∏–º–æ–≤ –†—É—Å—Ç–µ–º –•–∞–Ω–∏—Ñ–æ–≤–∏—á</div>
                        <div class="teacher-subject">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –≤ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ</div>
                    </div>
                    <span class="rating-badge" id="badge-mukhametrakhimov">-</span>
                </div>
                <div class="instructions">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É –æ—Ç 1 –¥–æ 5:</div>
                <div class="rating-options">
                    <label><input type="radio" name="teacher13" value="1" required> 1</label>
                    <label><input type="radio" name="teacher13" value="2"> 2</label>
                    <label><input type="radio" name="teacher13" value="3"> 3</label>
                    <label><input type="radio" name="teacher13" value="4"> 4</label>
                    <label><input type="radio" name="teacher13" value="5"> 5</label>
                </div>
                <div class="validation-error" id="error-teacher13">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É</div>
            </div>
        </div>

        <div class="teacher-counter">–í—Å–µ–≥–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –æ—Ü–µ–Ω–∫–∏: 13</div>
        
        <div id="statusMessage" class="status-message"></div>
        
        <button class="submit-btn" id="submitBtn" onclick="submitForm()">‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–Ω–∫–µ—Ç—É</button>
    </div>

    <div class="buttons-container">
        <button class="export-btn" onclick="exportTeachersToCSV()">üìä –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ (–ø–æ—Å—Ç—Ä–æ—á–Ω–æ)</button>
        <button class="export-btn" onclick="exportFullDataToCSV()">üìã –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö</button>
        <button class="export-btn" onclick="loadServerStats()" style="background-color: #673ab7;">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞</button>
        <button class="export-btn" onclick="clearLocalData()" style="background-color: #ff9800;">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
        <button class="export-btn" onclick="updateRatingsDisplay()" style="background-color: #4CAF50;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥–∏</button>
    </div>

    <div class="stats" id="stats">
        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∫–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</h3>
        <div id="statsContent">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
        <div id="serverStats" style="margin-top: 20px;"></div>
    </div>

    <script>
        // ‚ö†Ô∏è –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ—Ç URL –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π URL Google Apps Script!
        const SERVER_URL = 'https://script.google.com/macros/s/AKfycbwv3L0Bft3CPw4JxNdRTuLp4Q3ZnS5nTFN3qBTTScH6uTux15zDQJ2Ro8-ZHGV0fdi3/exec';
        
        let allResults = JSON.parse(localStorage.getItem('teacherRatings')) || [];
        let currentSort = 'original';
        let userIP = null;
        let hasVoted = false;
        
        const teachers = [
            { id: 'prokhorov', shortName: '–ü—Ä–æ—Ö–æ—Ä–æ–≤-–ú–∞–ª—è—Å–æ–≤', name: '–î–æ—Ü–µ–Ω—Ç –ü—Ä–æ—Ö–æ—Ä–æ–≤-–ú–∞–ª—è—Å–æ–≤ –ì–µ–æ—Ä–≥–∏–π –°–µ—Ä–≥–µ–µ–≤–∏—á', subject: '–§–∏–ª–æ—Å–æ—Ñ–∏—è', element: null, badge: null, rating: 0, voteCount: 0 },
            { id: 'antonova', shortName: '–ê–Ω—Ç–æ–Ω–æ–≤–∞', name: '–°—Ç–∞—Ä—à–∏–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –ê–Ω—Ç–æ–Ω–æ–≤–∞ –ò–ª—å–≤–∏—Ä–∞ –ò–ª–≥–∏–∑–æ–≤–Ω–∞', subject: '–≠–∫–æ–ª–æ–≥–∏—è', element: null, badge: null, rating: 0, voteCount: 0 },
            { id: 'siraziev', shortName: '–°–∏—Ä–∞–∑–∏–µ–≤', name: '–î–æ—Ü–µ–Ω—Ç –°–∏—Ä–∞–∑–∏–µ–≤ –õ–µ–Ω–∞—Ä –§–∏—Ä–≥–∞—Ç–µ–≤–∏—á', subject: '–ò–Ω–∂–µ–Ω–µ—Ä–Ω–∞—è –≥–µ–æ–ª–æ–≥–∏—è', element: null, badge: null, rating: 0, voteCount: 0 },
            { id: 'sibgatullin', shortName: '–°–∏–±–≥–∞—Ç—É–ª–ª–∏–Ω', name: '–î–æ—Ü–µ–Ω—Ç –°–∏–±–≥–∞—Ç—É–ª–ª–∏–Ω –ú–∞—Ä–∞—Ç –¢–∞—Ñ–∫–∏–ª–æ–≤–∏—á', subject: '–ú–µ—Ç—Ä–æ–ª–æ–≥–∏—è, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–æ–º', element: null, badge: null, rating: 0, voteCount: 0 },
            { id: 'ermolaeva', shortName: '–ï—Ä–º–æ–ª–∞–µ–≤–∞', name: '–î–æ—Ü–µ–Ω—Ç –ï—Ä–º–æ–ª–∞–µ–≤–∞ –õ–µ–π–ª–∞ –ë–∏–ª—Å—É—Ä–æ–≤–Ω–∞', subject: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏', element: null, badge: null, rating: 0, voteCount: 0 },
            { id: 'rakhimova', shortName: '–†–∞—Ö–∏–º–æ–≤–∞', name: '–ü—Ä–æ—Ñ–µ—Å—Å–æ—Ä –†–∞—Ö–∏–º–æ–≤–∞ –ù–∞–∏–ª—è –†–∞–≤–∏–ª–µ–≤–Ω–∞', subject: '–°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã', element: null, badge: null, rating: 0, voteCount: 0 },
            { id: 'kashina', shortName: '–ö–∞—à–∏–Ω–∞', name: '–î–æ—Ü–µ–Ω—Ç –ö–∞—à–∏–Ω–∞ –°–≤–µ—Ç–ª–∞–Ω–∞ –ì–µ–æ—Ä–≥–∏–µ–≤–Ω–∞', subject: '–ü—Ä–∞–≤–æ–≤–æ–µ —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞. –ö–æ—Ä—Ä—É–ø—Ü–∏–æ–Ω–Ω—ã–µ —Ä–∏—Å–∫–∏', element: null, badge: null, rating: 0, voteCount: 0 },
            { id: 'nizamova', shortName: '–ù–∏–∑–∞–º–æ–≤–∞', name: '–°—Ç–∞—Ä—à–∏–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –ù–∏–∑–∞–º–æ–≤–∞ –ê–∏–¥–∞ –•–∞–Ω–∏—Ñ–æ–≤–Ω–∞', subject: '–û—Å–Ω–æ–≤—ã –≤–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏—è –∏ –≤–æ–¥–æ–æ—Ç–≤–µ–¥–µ–Ω–∏—è', element: null, badge: null, rating: 0, voteCount: 0 },
            { id: 'medvedeva', shortName: '–ú–µ–¥–≤–µ–¥–µ–≤–∞', name: '–î–æ—Ü–µ–Ω—Ç –ú–µ–¥–≤–µ–¥–µ–≤–∞ –ì–∞–ª–∏–Ω–∞ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–Ω–∞', subject: '–û—Å–Ω–æ–≤—ã —Ç–µ–ø–ª–æ–≥–∞–∑–æ—Å–Ω–∞–±–∂–µ–Ω–∏—è –∏ –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—è', element: null, badge: null, rating: 0, voteCount: 0 },
            { id: 'sundukov', shortName: '–°—É–Ω–¥—É–∫–æ–≤', name: '–î–æ—Ü–µ–Ω—Ç –°—É–Ω–¥—É–∫–æ–≤ –í–∏–∫—Ç–æ—Ä –ò–≤–∞–Ω–æ–≤–∏—á', subject: '–≠–ª–µ–∫—Ç—Ä–æ—Ç–µ—Ö–Ω–∏–∫–∞ –∏ —ç–ª–µ–∫—Ç—Ä–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ', element: null, badge: null, rating: 0, voteCount: 0 },
            { id: 'mirsayapov', shortName: '–ú–∏—Ä—Å–∞—è–ø–æ–≤', name: '–ü—Ä–æ—Ñ–µ—Å—Å–æ—Ä –ú–∏—Ä—Å–∞—è–ø–æ–≤ –ò–ª–∏–∑–∞—Ä –¢–∞–ª–≥–∞—Ç–æ–≤–∏—á', subject: '–û—Å–Ω–æ–≤—ã –≥–µ–æ—Ç–µ—Ö–Ω–∏–∫–∏', element: null, badge: null, rating: 0, voteCount: 0 },
            { id: 'ivantsov', shortName: '–ò–≤–∞–Ω—Ü–æ–≤', name: '–î–æ—Ü–µ–Ω—Ç –ò–≤–∞–Ω—Ü–æ–≤ –ê–ª–µ–∫—Å–µ–π –ò–≥–æ—Ä–µ–≤–∏—á', subject: '–û—Å–Ω–æ–≤—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã', element: null, badge: null, rating: 0, voteCount: 0 },
            { id: 'mukhametrakhimov', shortName: '–ú—É—Ö–∞–º–µ—Ç—Ä–∞—Ö–∏–º–æ–≤', name: '–î–æ—Ü–µ–Ω—Ç –ú—É—Ö–∞–º–µ—Ç—Ä–∞—Ö–∏–º–æ–≤ –†—É—Å—Ç–µ–º –•–∞–Ω–∏—Ñ–æ–≤–∏—á', subject: '–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –≤ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ', element: null, badge: null, rating: 0, voteCount: 0 }
        ];

        // –ü–æ–ª—É—á–∞–µ–º IP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function getUserIP() {
            if (userIP) return userIP;
            
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                userIP = data.ip;
                console.log('IP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', userIP);
                return userIP;
            } catch (error) {
                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å IP:', error);
                userIP = 'local_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                return userIP;
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
        async function checkVotingStatus() {
            try {
                const ip = await getUserIP();
                const response = await fetch(`${SERVER_URL}?action=check&ip=${encodeURIComponent(ip)}`);
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.alreadyVoted) {
                        hasVoted = true;
                        disableForm();
                        showMessage('–í—ã —É–∂–µ –≥–æ–ª–æ—Å–æ–≤–∞–ª–∏ —Å —ç—Ç–æ–≥–æ IP-–∞–¥—Ä–µ—Å–∞. –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ.', 'error');
                        return true;
                    }
                }
                return false;
            } catch (error) {
                console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è:', error);
                return false;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', async function() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º IP
            await getUserIP();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
            await checkVotingStatus();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π
            teachers.forEach(teacher => {
                teacher.element = document.querySelector(`[data-teacher="${teacher.id}"]`);
                teacher.badge = document.getElementById(`badge-${teacher.id}`);
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            for (let i = 1; i <= 13; i++) {
                const radios = document.querySelectorAll(`input[name="teacher${i}"]`);
                radios.forEach(radio => {
                    radio.addEventListener('change', updateProgress);
                });
            }
            
            document.getElementById('group').addEventListener('change', updateProgress);
            
            updateProgress();
            updateRatingsDisplay();
            updateLocalStats();
        });

        // –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã
        function disableForm() {
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '‚õî –í—ã —É–∂–µ –≥–æ–ª–æ—Å–æ–≤–∞–ª–∏';
            submitBtn.style.backgroundColor = '#9e9e9e';
            
            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.disabled = true;
            });
            
            document.getElementById('group').disabled = true;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(text, type = 'info') {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = text;
            statusDiv.className = 'status-message';
            
            switch(type) {
                case 'success':
                    statusDiv.classList.add('status-success');
                    break;
                case 'error':
                    statusDiv.classList.add('status-error');
                    break;
                default:
                    statusDiv.classList.add('status-info');
            }
            
            statusDiv.style.display = 'block';
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            if (type === 'success') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        function updateProgress() {
            if (hasVoted) return;
            
            let filledCount = 0;
            
            for (let i = 1; i <= 13; i++) {
                const radio = document.querySelector(`input[name="teacher${i}"]:checked`);
                if (radio) {
                    filledCount++;
                    document.getElementById(`error-teacher${i}`).style.display = 'none';
                    const teacherBlock = document.querySelector(`[data-teacher="${teachers[i-1].id}"]`);
                    if (teacherBlock) teacherBlock.classList.remove('unrated');
                }
            }
            
            const group = document.getElementById('group').value;
            if (!group) {
                document.getElementById('groupError').style.display = 'block';
            } else {
                document.getElementById('groupError').style.display = 'none';
            }
            
            const progress = Math.round((filledCount / 13) * 100);
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = 
                `–ó–∞–ø–æ–ª–Ω–µ–Ω–æ: ${filledCount}/13 –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π (${progress}%)`;
            
            const submitBtn = document.getElementById('submitBtn');
            if (submitBtn && !hasVoted) {
                submitBtn.disabled = !(filledCount === 13 && group);
            }
        }

        // –†–∞—Å—á–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥–æ–≤
        function calculateRatings() {
            if (allResults.length === 0) {
                teachers.forEach(t => {
                    t.rating = 0;
                    t.voteCount = 0;
                });
                return;
            }
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–µ–π—Ç–∏–Ω–≥–∏
            teachers.forEach(t => {
                t.rating = 0;
                t.voteCount = 0;
            });
            
            // –°—á–∏—Ç–∞–µ–º —Å—É–º–º—ã –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ–ª–æ—Å–æ–≤
            allResults.forEach(result => {
                teachers.forEach((teacher, index) => {
                    const teacherKey = `teacher${index + 1}`;
                    if (result[teacherKey]) {
                        teacher.rating += parseInt(result[teacherKey]);
                        teacher.voteCount = (teacher.voteCount || 0) + 1;
                    }
                });
            });
            
            // –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥–Ω–∏–µ
            teachers.forEach(teacher => {
                if (teacher.voteCount > 0) {
                    teacher.rating = (teacher.rating / teacher.voteCount).toFixed(2);
                } else {
                    teacher.rating = 0;
                }
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–æ–≤
        function updateRatingsDisplay() {
            calculateRatings();
            
            teachers.forEach(teacher => {
                if (teacher.badge) {
                    teacher.badge.textContent = teacher.rating > 0 ? teacher.rating : '-';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º data-–∞—Ç—Ä–∏–±—É—Ç –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
                    if (teacher.element) {
                        teacher.element.setAttribute('data-rating', teacher.rating);
                        
                        // –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è
                        teacher.element.classList.remove('high-rated', 'low-rated', 'unrated');
                        if (teacher.rating >= 4) {
                            teacher.element.classList.add('high-rated');
                        } else if (teacher.rating > 0 && teacher.rating < 3) {
                            teacher.element.classList.add('low-rated');
                        }
                    }
                }
            });
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–∫—É—â—É—é —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É
            sortTeachers(currentSort);
        }

        // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π
        function sortTeachers(sortType) {
            currentSort = sortType;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.sort-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            let activeBtn = null;
            switch(sortType) {
                case 'original': activeBtn = document.querySelector('.sort-btn:nth-child(1)'); break;
                case 'rating': activeBtn = document.querySelector('.sort-btn:nth-child(2)'); break;
                case 'rating-asc': activeBtn = document.querySelector('.sort-btn:nth-child(3)'); break;
                case 'alphabet': activeBtn = document.querySelector('.sort-btn:nth-child(4)'); break;
            }
            if (activeBtn) activeBtn.classList.add('active');
            
            const container = document.getElementById('teachers-container');
            const teacherBlocks = Array.from(container.children);
            
            switch(sortType) {
                case 'original':
                    // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ (–∫–∞–∫ –≤ –º–∞—Å—Å–∏–≤–µ teachers)
                    teacherBlocks.sort((a, b) => {
                        const aId = a.getAttribute('data-teacher');
                        const bId = b.getAttribute('data-teacher');
                        const order = teachers.map(t => t.id);
                        return order.indexOf(aId) - order.indexOf(bId);
                    });
                    break;
                    
                case 'rating':
                    // –ü–æ —É–±—ã–≤–∞–Ω–∏—é —Ä–µ–π—Ç–∏–Ω–≥–∞
                    teacherBlocks.sort((a, b) => {
                        const aRating = parseFloat(a.getAttribute('data-rating')) || 0;
                        const bRating = parseFloat(b.getAttribute('data-rating')) || 0;
                        return bRating - aRating;
                    });
                    break;
                    
                case 'rating-asc':
                    // –ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é —Ä–µ–π—Ç–∏–Ω–≥–∞
                    teacherBlocks.sort((a, b) => {
                        const aRating = parseFloat(a.getAttribute('data-rating')) || 0;
                        const bRating = parseFloat(b.getAttribute('data-rating')) || 0;
                        return aRating - bRating;
                    });
                    break;
                    
                case 'alphabet':
                    // –ü–æ –∞–ª—Ñ–∞–≤–∏—Ç—É (–ø–æ —Ñ–∞–º–∏–ª–∏–∏)
                    teacherBlocks.sort((a, b) => {
                        const aId = a.getAttribute('data-teacher');
                        const bId = b.getAttribute('data-teacher');
                        const teacherA = teachers.find(t => t.id === aId);
                        const teacherB = teachers.find(t => t.id === bId);
                        return teacherA.shortName.localeCompare(teacherB.shortName, 'ru');
                    });
                    break;
            }
            
            // –ü–µ—Ä–µ–º–µ—â–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –Ω–æ–≤–æ–º –ø–æ—Ä—è–¥–∫–µ
            teacherBlocks.forEach(block => container.appendChild(block));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateLocalStats();
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
        async function submitForm() {
            if (hasVoted) {
                showMessage('–í—ã —É–∂–µ –≥–æ–ª–æ—Å–æ–≤–∞–ª–∏!', 'error');
                return;
            }
            
            const groupSelect = document.getElementById('group');
            let group = groupSelect.value;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ "–î—Ä—É–≥–∞—è –≥—Ä—É–ø–ø–∞"
            if (group === '–î—Ä—É–≥–∞—è') {
                group = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–π –≥—Ä—É–ø–ø—ã:', '');
                if (!group || group.trim() === '') {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã');
                    return;
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –æ—Ü–µ–Ω–æ–∫
            let allRated = true;
            let missingTeachers = [];
            
            for (let i = 1; i <= 13; i++) {
                const radio = document.querySelector(`input[name="teacher${i}"]:checked`);
                if (!radio) {
                    allRated = false;
                    missingTeachers.push(i);
                    document.getElementById(`error-teacher${i}`).style.display = 'block';
                }
            }
            
            if (!group) {
                document.getElementById('groupError').style.display = 'block';
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É!');
                return;
            }
            
            if (!allRated) {
                alert(`–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ—Å—Ç–∞–≤—å—Ç–µ –æ—Ü–µ–Ω–∫–∏ –≤—Å–µ–º –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è–º!\n–ù–µ –æ—Ü–µ–Ω–µ–Ω—ã: –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ ‚Ññ${missingTeachers.join(', ')}`);
                return;
            }

            // –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
            const formData = {
                ip: userIP,
                group: group,
                timestamp: new Date().toLocaleString('ru-RU')
            };
            
            for (let i = 1; i <= 13; i++) {
                const radio = document.querySelector(`input[name="teacher${i}"]:checked`);
                if (radio) {
                    formData[`teacher${i}`] = radio.value;
                }
            }

            // –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            showMessage('–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä...', 'info');
            
            try {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ Google Apps Script
                const response = await fetch(SERVER_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                // –ü—Ä–æ–±—É–µ–º –ø—Ä–æ—á–∏—Ç–∞—Ç—å –æ—Ç–≤–µ—Ç
                const result = await response.json();
                
                if (result.success) {
                    showMessage('‚úÖ –ê–Ω–∫–µ—Ç–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –°–ø–∞—Å–∏–±–æ –∑–∞ —É—á–∞—Å—Ç–∏–µ!', 'success');
                    hasVoted = true;
                    disableForm();
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                    allResults.push(formData);
                    localStorage.setItem('teacherRatings', JSON.stringify(allResults));
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    document.querySelectorAll('input[type="radio"]').forEach(radio => radio.checked = false);
                    groupSelect.value = '';
                    updateProgress();
                    updateRatingsDisplay();
                    updateLocalStats();
                    
                } else if (result.message && result.message.includes('—É–∂–µ –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª')) {
                    showMessage('‚ùå ' + result.message, 'error');
                    hasVoted = true;
                    disableForm();
                } else {
                    showMessage('‚ùå –û—à–∏–±–∫–∞: ' + (result.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
                
                // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                showMessage('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä. –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ.', 'info');
                
                allResults.push(formData);
                localStorage.setItem('teacherRatings', JSON.stringify(allResults));
                hasVoted = true;
                disableForm();
                
                document.querySelectorAll('input[type="radio"]').forEach(radio => radio.checked = false);
                groupSelect.value = '';
                updateProgress();
                updateRatingsDisplay();
                updateLocalStats();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞
        async function loadServerStats() {
            showMessage('–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞...', 'info');
            
            try {
                const response = await fetch(`${SERVER_URL}?action=stats`);
                
                if (response.ok) {
                    const data = await response.json();
                    
                    let statsHTML = `<h4>üìä –î–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞ (–≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏):</h4>`;
                    statsHTML += `<p><strong>–í—Å–µ–≥–æ –æ—Ç–≤–µ—Ç–æ–≤:</strong> ${data.total || 0}</p>`;
                    
                    if (data.byGroup && Object.keys(data.byGroup).length > 0) {
                        statsHTML += `<p><strong>–£—á–∞—Å—Ç–∏–µ –ø–æ –≥—Ä—É–ø–ø–∞–º:</strong></p>`;
                        statsHTML += '<ul>';
                        for (const [group, count] of Object.entries(data.byGroup)) {
                            statsHTML += `<li><strong>${group}</strong>: ${count} –∞–Ω–∫–µ—Ç</li>`;
                        }
                        statsHTML += '</ul>';
                    } else {
                        statsHTML += `<p><em>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –≥—Ä—É–ø–ø–∞–º</em></p>`;
                    }
                    
                    document.getElementById('serverStats').innerHTML = statsHTML;
                    showMessage('‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'success');
                    
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
                document.getElementById('serverStats').innerHTML = 
                    '<p style="color: #d32f2f;">‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–∞.</p>';
                showMessage('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏', 'error');
            }
        }

        // –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π (–ø–æ—Å—Ç—Ä–æ—á–Ω–æ)
        function exportTeachersToCSV() {
            calculateRatings();
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É (—É–±—ã–≤–∞–Ω–∏—é)
            const sortedTeachers = [...teachers].filter(t => t.rating > 0).sort((a, b) => b.rating - a.rating);
            
            if (sortedTeachers.length === 0) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ä–µ–π—Ç–∏–Ω–≥–∞—Ö –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π');
                return;
            }

            // –ó–∞–≥–æ–ª–æ–≤–∫–∏
            const headers = ['‚Ññ', '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å', '–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞', '–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª', '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ü–µ–Ω–æ–∫'];
            
            // –î–∞–Ω–Ω—ã–µ
            const rows = sortedTeachers.map((teacher, index) => [
                index + 1,
                teacher.name,
                teacher.subject,
                teacher.rating,
                teacher.voteCount
            ]);

            // –ú–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            const BOM = '\uFEFF';
            const csvContent = BOM + [
                '"–ê–ù–ö–ï–¢–ê: –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –≥–ª–∞–∑–∞–º–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞ - –†–µ–π—Ç–∏–Ω–≥–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π"',
                `"–î–∞—Ç–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${new Date().toLocaleString('ru-RU')}"`,
                `"–í—Å–µ–≥–æ –æ—Ç–≤–µ—Ç–æ–≤: ${allResults.length}"`,
                `"–í—Å–µ–≥–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π: ${sortedTeachers.length}"`,
                '',
                headers.join(','),
                ...rows.map(row => row.map(cell => `"${cell}"`).join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { 
                type: 'text/csv;charset=utf-8;' 
            });
            
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.href = url;
            const dateStr = new Date().toISOString().slice(0,10);
            link.download = `–†–µ–π—Ç–∏–Ω–≥–∏_–ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π_${dateStr}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            setTimeout(() => URL.revokeObjectURL(url), 100);
            
            alert(`–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${sortedTeachers.length} –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π —Å —Ä–µ–π—Ç–∏–Ω–≥–∞–º–∏`);
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö (—Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç)
        function exportFullDataToCSV() {
            if (allResults.length === 0) {
                alert('–ù–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞');
                return;
            }

            const headers = ['IP', '–ì—Ä—É–ø–ø–∞', '–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è'];
            for (let i = 1; i <= 13; i++) {
                const teacher = teachers[i-1];
                headers.push(`${teacher.shortName}`);
            }
            
            const rows = allResults.map(r => {
                const rowData = [r.ip || '–ª–æ–∫–∞–ª—å–Ω—ã–π', r.group, r.timestamp];
                for (let i = 1; i <= 13; i++) {
                    rowData.push(r[`teacher${i}`] || '');
                }
                return rowData;
            });

            const BOM = '\uFEFF';
            const csvContent = BOM + [
                '"–ê–ù–ö–ï–¢–ê: –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –≥–ª–∞–∑–∞–º–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞ - –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ"',
                `"–î–∞—Ç–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${new Date().toLocaleString('ru-RU')}"`,
                `"–í—Å–µ–≥–æ –æ—Ç–≤–µ—Ç–æ–≤: ${allResults.length}"`,
                '',
                headers.join(','),
                ...rows.map(row => row.map(cell => `"${cell}"`).join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { 
                type: 'text/csv;charset=utf-8;' 
            });
            
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.href = url;
            const dateStr = new Date().toISOString().slice(0,10);
            link.download = `–ü–æ–ª–Ω—ã–µ_–¥–∞–Ω–Ω—ã–µ_–∞–Ω–∫–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è_${dateStr}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            setTimeout(() => URL.revokeObjectURL(url), 100);
            
            alert(`–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${allResults.length} –∑–∞–ø–∏—Å–µ–π`);
        }

        // –û—á–∏—Å—Ç–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function clearLocalData() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ –Ω–µ —É–¥–∞–ª–∏—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.\n\n–ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç —Å–Ω–æ–≤–∞ –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ.')) {
                localStorage.removeItem('teacherRatings');
                allResults = [];
                hasVoted = false;
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ—Ä–º—É
                const submitBtn = document.getElementById('submitBtn');
                submitBtn.disabled = false;
                submitBtn.innerHTML = '‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–Ω–∫–µ—Ç—É';
                submitBtn.style.backgroundColor = '#4CAF50';
                
                document.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.disabled = false;
                    radio.checked = false;
                });
                
                document.getElementById('group').disabled = false;
                document.getElementById('group').value = '';
                
                updateProgress();
                updateRatingsDisplay();
                updateLocalStats();
                showMessage('–õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã. –§–æ—Ä–º–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞.', 'success');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateLocalStats() {
            const statsDiv = document.getElementById('statsContent');
            if (!statsDiv) return;
            
            if (allResults.length === 0) {
                statsDiv.innerHTML = '<p>–õ–æ–∫–∞–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>';
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É
            const sortedTeachers = [...teachers].filter(t => t.rating > 0).sort((a, b) => b.rating - a.rating);
            
            let statsHTML = `<p><strong>–õ–æ–∫–∞–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã:</strong> ${allResults.length}</p>`;
            
            // –°–ø–∏—Å–æ–∫ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π —Å —Ä–µ–π—Ç–∏–Ω–≥–∞–º–∏
            if (sortedTeachers.length > 0) {
                statsHTML += `<p><strong>–†–µ–π—Ç–∏–Ω–≥–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π (–ª–æ–∫–∞–ª—å–Ω–æ):</strong></p>`;
                statsHTML += '<div class="stats-list">';
                sortedTeachers.forEach((teacher, index) => {
                    const medal = index === 0 ? 'ü•á ' : index === 1 ? 'ü•à ' : index === 2 ? 'ü•â ' : `${index + 1}. `;
                    statsHTML += `
                        <div class="teacher-stat">
                            <div class="stat-name">${medal}<strong>${teacher.shortName}</strong></div>
                            <div class="stat-subject">${teacher.subject}</div>
                            <div class="stat-rating">${teacher.rating}</div>
                        </div>
                    `;
                });
                statsHTML += '</div>';
            }
            
            // –°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥
            const avgRating = sortedTeachers.reduce((sum, t) => sum + parseFloat(t.rating || 0), 0) / sortedTeachers.length;
            statsHTML += `<p><strong>–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –ø–æ –≤—Å–µ–º –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è–º:</strong> ${avgRating.toFixed(2)}</p>`;
            
            statsDiv.innerHTML = statsHTML;
        }
    </script>
</body>
</html>